<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bảng Điều Khiển</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
</head>
<body>
    <nav class="navbar is-primary" role="navigation" aria-label="main navigation">
        <div class="navbar-brand">
            <a class="navbar-item" href="#">
                <strong>Hệ Thống Phân Phối Thuốc</strong>
            </a>
            
            <a role="button" class="navbar-burger" aria-label="menu" aria-expanded="false" data-target="navbarBasic">
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
                <span aria-hidden="true"></span>
            </a>
        </div>
        
        <div id="navbarBasic" class="navbar-menu">
            <div class="navbar-start">
                <a class="navbar-item tab-link" data-tab="dashboard">
                    Tổng quan
                </a>
                
                <div class="navbar-item has-dropdown is-hoverable" id="actions-dropdown">
                    <a class="navbar-link">
                        Hành động
                    </a>
                    
                    <div class="navbar-dropdown" id="role-actions">
                        <!-- Dynamic content based on role -->
                    </div>
                </div>
                
                <a class="navbar-item tab-link" data-tab="medicines">
                    Quản lý thuốc
                </a>
                
                <a class="navbar-item tab-link" data-tab="tracking">
                    Tra cứu thuốc
                </a>
            </div>
            
            <div class="navbar-end">
                <div class="navbar-item">
                    <div class="buttons">
                        <a class="button is-light" href="index.html">
                            Đăng xuất
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-3">
                    <aside class="menu">
                        <p class="menu-label" id="user-role">
                            Vai trò
                        </p>
                        <p class="menu-label" id="user-name">
                            Tên người dùng
                        </p>
                        <p class="menu-label">
                            Chức năng
                        </p>
                        <ul class="menu-list">
                            <li><a class="tab-link" data-tab="dashboard">Tổng quan</a></li>
                            <li id="role-specific-menu">
                                <!-- Dynamic content based on role -->
                            </li>
                            <li><a class="tab-link" data-tab="medicines">Quản lý thuốc</a></li>
                            <li><a class="tab-link" data-tab="tracking">Tra cứu thuốc</a></li>
                        </ul>
                    </aside>
                </div>
                
                <div class="column is-9">
                    <!-- Dashboard Tab -->
                    <div class="tab-content" id="dashboard">
                        <h1 class="title">Tổng quan</h1>
                        <div class="columns">
                            <div class="column">
                                <div class="box has-text-centered">
                                    <p class="heading">Tổng số thuốc</p>
                                    <p class="title" id="total-medicines">3</p>
                                </div>
                            </div>
                            <div class="column">
                                <div class="box has-text-centered">
                                    <p class="heading">Tổng số lô</p>
                                    <p class="title" id="total-batches">4</p>
                                </div>
                            </div>
                            <div class="column">
                                <div class="box has-text-centered">
                                    <p class="heading">Đơn hàng</p>
                                    <p class="title" id="total-orders">2</p>
                                </div>
                            </div>
                            <div class="column">
                                <div class="box has-text-centered">
                                    <p class="heading">Đơn thuốc</p>
                                    <p class="title" id="total-prescriptions">2</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="box" id="recent-activity">
                            <h2 class="subtitle">Hoạt động gần đây</h2>
                            <div class="content">
                                <ul id="activity-list">
                                    <!-- Dynamic content -->
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Manufacturer Tab -->
                    <div class="tab-content is-hidden" id="manufacturer">
                        <h1 class="title">Quản lý sản xuất</h1>
                        <div class="box">
                            <h2 class="subtitle">Thêm thuốc mới</h2>
                            <form id="add-medicine-form">
                                <div class="field">
                                    <label class="label">Mã thuốc</label>
                                    <div class="control">
                                        <input class="input" type="text" id="new-medicine-code" placeholder="Nhập mã thuốc">
                                    </div>
                                </div>
                                <div class="field">
                                    <label class="label">Tên thuốc</label>
                                    <div class="control">
                                        <input class="input" type="text" id="new-medicine-name" placeholder="Nhập tên thuốc">
                                    </div>
                                </div>
                                <div class="field">
                                    <label class="label">Ngày sản xuất</label>
                                    <div class="control">
                                        <input class="input" type="date" id="new-medicine-production-date">
                                    </div>
                                </div>
                                <div class="field">
                                    <label class="label">Hạn sử dụng</label>
                                    <div class="control">
                                        <input class="input" type="date" id="new-medicine-expiry-date">
                                    </div>
                                </div>
                                <div class="field">
                                    <label class="label">Lô sản xuất</label>
                                    <div class="control">
                                        <input class="input" type="text" id="new-medicine-batch" placeholder="Nhập lô sản xuất">
                                    </div>
                                </div>
                                <div class="field">
                                    <label class="label">Số lượng</label>
                                    <div class="control">
                                        <input class="input" type="text" id="new-medicine-quantity" placeholder="Nhập số lượng sản xuất">
                                    </div>
                                </div>
                                
                                <div class="field">
                                    <div class="control">
                                        <button class="button is-primary" type="button" id="generate-medicine-button">Tạo thuốc mới</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                        
                        <div class="box">
                            <h2 class="subtitle">Thuốc đã sản xuất</h2>
                            <table class="table is-fullwidth">
                                <thead>
                                    <tr>
                                        <th>Mã thuốc</th>
                                        <th>Tên thuốc</th>
                                        <th>Ngày sản xuất</th>
                                        <th>Hạn sử dụng</th>
                                        <th>Lô sản xuất</th>
                                        <th>Số lượng</th>
                                        <th>Mã Log</th>
                                    </tr>
                                </thead>
                                <tbody id="manufacturer-medicines">
                                    <!-- Dynamic content -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Distributor Tab -->
                    <div class="tab-content is-hidden" id="distributor">
    <h1 class="title">Quản lý phân phối</h1>
    <div class="box">
        <h2 class="subtitle">Nhập kho thuốc từ nhà sản xuất</h2>
        <form id="receive-medicine-form">
            <div class="field">
                <label class="label">Mã ghi nhận</label>
                <div class="control">
                    <input class="input" type="text" id="receive-medicine-logid" placeholder="Nhập mã ghi nhận">
                </div>
            </div>
            <div class="field">
                <label class="label">Số lượng</label>
                <div class="control">
                    <input class="input" type="number" id="receive-medicine-quantity" placeholder="Nhập số lượng">
                </div>
            </div>
            <div class="field">
                    <label class="label" for="role-select">Chọn Kho</label>
                    <div class="control">
                        <div class="select is-fullwidth">
                            <select name="role-select" id="storage-select">
                                <option value="0">--Chọn kho--</option>
                                <option value="1">Kho A</option>
                                <option value="2">Kho B</option>
                            </select>
                        </div>
                    </div>
                </div>
            <div class="field">
                <div class="control">
                    <button class="button is-primary" type="button" id="receive-medicine-button">Nhập kho</button>
                </div>
            </div>
        </form>
    </div>
    
    <div class="box">
        <h2 class="subtitle">Yêu cầu đặt hàng từ nhà thuốc</h2>
        <table class="table is-fullwidth">
            <thead>
                <tr>
                    <th>Mã yêu cầu</th>
                    <th>Nhà thuốc</th>
                    <th>Ngày yêu cầu</th>
                    <th>Trạng thái</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tbody id="order-requests">
                <!-- Dynamic content -->
            </tbody>
        </table>
    </div>
    
    <div class="box">
        <h2 class="subtitle">Kho thuốc</h2>
        <table class="table is-fullwidth">
            <thead>
                <tr>
                    <th>Mã thuốc</th>
                    <th>Tên thuốc</th>
                    <th>Số lượng</th>
                    <th>Hạn sử dụng</th>
                    <th>Kho nhận</th>
                    <th>Mã ghi nhận</th>
                </tr>
            </thead>
            <tbody id="distributor-inventory">
                <!-- Dynamic content -->
            </tbody>
        </table>
    </div>
</div>
                    
                    <!-- Pharmacy Tab -->
                    <div class="tab-content is-hidden" id="pharmacy">
    <h1 class="title">Quản lý nhà thuốc</h1>
    <div class="box">
        <h2 class="subtitle">Yêu cầu nhập thuốc từ nhà phân phối</h2>
        <form id="create-request-form">
            <div class="field">
                <label class="label">Nhà phân phối</label>
                <div class="control">
                    <div class="select is-fullwidth">
                        <select id="request-distributor">
                            <option value="">--Chọn nhà phân phối--</option>

                        </select>
                    </div>
                </div>
            </div>
            
            <div id="request-items">
                <div class="request-item">
                    <div class="field">
                        <label class="label">Mã thuốc</label>
                        <div class="control">
                            <input class="input" id="request-medicine" type="text" placeholder="Nhập mã thuốc">
                        </div>
                    </div>
                    <div class="field">
                        <label class="label">Số lượng</label>
                        <div class="control">
                            <input class="input" id="request-quantity" type="number" min="1" placeholder="Nhập số lượng">
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="field">
                <div class="control">
                    <button class="button is-info" type="button" id="add-item-to-request">+ Thêm thuốc</button>
                </div>
            </div>
            
            <div class="field">
                <div class="control">
                    <button class="button is-primary" type="button" id="create-request-button">Tạo yêu cầu</button>
                </div>
            </div>
        </form>
    </div>
    
    <div class="box">
        <h2 class="subtitle">Đơn hàng cần xử lý</h2>
        <table class="table is-fullwidth">
            <thead>
                <tr>
                    <th>Mã đơn hàng</th>
                    <th>Bệnh nhân</th>
                    <th>Ngày đặt</th>
                    <th>Trạng thái</th>
                    <th>Phê duyệt</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tbody id="pharmacy-orders">
                <!-- Dynamic content -->
            </tbody>
        </table>
    </div>
    
    <div class="box">
        <h2 class="subtitle">Kho thuốc</h2>
        <table class="table is-fullwidth">
            <thead>
                <tr>
                    <th>Mã thuốc</th>
                    <th>Tên thuốc</th>
                    <th>Số lượng</th>
                    <th>Hạn sử dụng</th>
                    <th>Mã ghi nhận</th>
                </tr>
            </thead>
            <tbody id="pharmacy-inventory">
                <!-- Dynamic content -->
            </tbody>
        </table>
    </div>
</div>
                    
                    <!-- Doctor Tab -->
                    <div class="tab-content is-hidden" id="doctor">
    <h1 class="title">Quản lý kê đơn</h1>
    <div class="box">
        <h2 class="subtitle">Tạo đơn thuốc mới</h2>
        <form id="create-prescription-form">
            <div class="field">
                <label class="label">Bệnh nhân</label>
                <div class="control">
                    <div class="select is-fullwidth">
                        <select id="prescription-patient">
                            <option value="">--Chọn bệnh nhân--</option>
                            <option value="501">Nguyễn Văn X</option>
                            <option value="502">Trần Thị Y</option>
                            <option value="503">Lê Văn Z</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div id="prescription-medicines">
                <div class="prescription-medicine">
                    <div class="field">
                        <label class="label">Thuốc</label>
                        <div class="control">
                            <div class="select is-fullwidth">
                                <select class="prescription-medicine-select" onchange="updatePrescriptionLogIdOptions(this)">
                                    <option value="">--Chọn thuốc--</option>
                                    <option value="MED001">Paracetamol 500mg</option>
                                    <option value="MED002">Amoxicillin 500mg</option>
                                    <option value="MED003">Omeprazole 20mg</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="field">
                        <label class="label">Mã ghi nhận</label>
                        <div class="control">
                            <div class="select is-fullwidth">
                                <select class="prescription-logid">
                                    <option value="">--Chọn mã ghi nhận--</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="field">
                        <label class="label">Liều dùng</label>
                        <div class="control">
                            <input class="input prescription-dosage" type="text" placeholder="VD: 1 viên x 3 lần/ngày">
                        </div>
                    </div>
                    <div class="field">
                        <label class="label">Thời gian dùng</label>
                        <div class="control">
                            <input class="input prescription-duration" type="text" placeholder="VD: 5 ngày">
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="field">
                <div class="control">
                    <button class="button is-info" type="button" id="add-medicine-to-prescription">+ Thêm thuốc</button>
                </div>
            </div>
            
            <div class="field">
                <label class="label">Ghi chú</label>
                <div class="control">
                    <textarea class="textarea" id="prescription-notes" placeholder="Ghi chú cho đơn thuốc"></textarea>
                </div>
            </div>
            
            <div class="field">
                <div class="control">
                    <button class="button is-primary" type="button" id="create-prescription-button">Tạo đơn thuốc</button>
                </div>
            </div>
        </form>
    </div>
    
    <div class="box">
        <h2 class="subtitle">Đơn thuốc đã kê</h2>
        <table class="table is-fullwidth">
            <thead>
                <tr>
                    <th>Mã đơn thuốc</th>
                    <th>Bệnh nhân</th>
                    <th>Ngày kê</th>
                    <th>Trạng thái</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tbody id="doctor-prescriptions">
                <!-- Dynamic content -->
            </tbody>
        </table>
    </div>
    
    <div class="box">
        <h2 class="subtitle">Đơn hàng cần phê duyệt</h2>
        <table class="table is-fullwidth">
            <thead>
                <tr>
                    <th>Mã đơn hàng</th>
                    <th>Bệnh nhân</th>
                    <th>Nhà thuốc</th>
                    <th>Ngày đặt</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tbody id="doctor-orders">
                <!-- Dynamic content -->
            </tbody>
        </table>
    </div>
</div>
                    
                    <!-- Patient Tab -->
                    <div class="tab-content is-hidden" id="patient">
    <h1 class="title">Quản lý đơn thuốc</h1>
    <div class="box">
        <h2 class="subtitle">Đơn thuốc của bạn</h2>
        <table class="table is-fullwidth">
            <thead>
                <tr>
                    <th>Mã đơn thuốc</th>
                    <th>Bác sĩ</th>
                    <th>Ngày kê</th>
                    <th>Trạng thái</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tbody id="patient-prescriptions">
                <!-- Dynamic content -->
            </tbody>
        </table>
    </div>
    
    <div class="box">
        <h2 class="subtitle">Đơn hàng của bạn</h2>
        <table class="table is-fullwidth">
            <thead>
                <tr>
                    <th>Mã đơn hàng</th>
                    <th>Nhà thuốc</th>
                    <th>Ngày đặt</th>
                    <th>Trạng thái</th>
                    <th>Hành động</th>
                </tr>
            </thead>
            <tbody id="patient-orders">
                <!-- Dynamic content -->
            </tbody>
        </table>
    </div>
    
    <div class="box">
        <h2 class="subtitle">Đặt hàng mới</h2>
        <form id="create-order-form">
            <div class="field">
                <label class="label">Đơn thuốc</label>
                <div class="control">
                    <div class="select is-fullwidth">
                        <select id="order-prescription">
                            <option value="">--Chọn đơn thuốc--</option>
                            <!-- Dynamic content -->
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="field">
                <label class="label">Nhà thuốc</label>
                <div class="control">
                    <div class="select is-fullwidth">
                        <select id="order-pharmacy">
                            <option value="">--Chọn nhà thuốc--</option>
                            <option value="301">Nhà thuốc Long Châu</option>
                            <option value="302">Nhà thuốc An Khang</option>
                            <option value="303">Nhà thuốc Pharmacity</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="field">
                <div class="control">
                    <button class="button is-primary" type="button" id="create-order-button">Đặt hàng</button>
                </div>
            </div>
        </form>
    </div>
</div>
                    
                    <!-- Medicines Tab -->
                    <div class="tab-content is-hidden" id="medicines">
                        <h1 class="title">Quản lý thuốc</h1>
                        <div class="field has-addons">
                            <div class="control is-expanded">
                                <input class="input" type="text" id="medicine-search" placeholder="Tìm kiếm thuốc...">
                            </div>
                            <div class="control">
                                <button class="button is-info" id="search-medicine-button">
                                    Tìm kiếm
                                </button>
                            </div>
                        </div>
                        
                        <table class="table is-fullwidth">
                            <thead>
                                <tr>
                                    <th>Mã thuốc</th>
                                    <th>Tên thuốc</th>
                                    <th>Hạn sử dụng</th>
                                </tr>
                            </thead>
                            <tbody id="medicines-list">
                                <!-- Dynamic content -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Tracking Tab -->
                    <div class="tab-content is-hidden" id="tracking">
    <h1 class="title">Tra cứu thuốc</h1>
    <div class="box">
        <div class="field">
            <label class="label">Nhập mã thuốc:</label>
            <div class="control">
                <input class="input" type="text" id="track-medicine-code" placeholder="Nhập mã QR hoặc mã vạch">
            </div>
        </div>
        <button class="button is-primary" id="track-medicine-button">Tra cứu</button>
        
        <div id="track-medicine-info" class="mt-4 is-hidden">
            <h3 class="subtitle">Thông tin thuốc</h3>
            <div class="box">
                <p><strong>Tên thuốc:</strong> <span id="track-medicine-name"></span></p>
                <p><strong>Nhà sản xuất:</strong> <span id="track-medicine-manufacturer"></span></p>
                <p><strong>Ngày sản xuất:</strong> <span id="track-medicine-production-date"></span></p>
                <p><strong>Hạn sử dụng:</strong> <span id="track-medicine-expiry-date"></span></p>
                <p><strong>Lô sản xuất:</strong> <span id="track-medicine-batch"></span></p>
                <p><strong>Mã ghi nhận:</strong> <span id="track-medicine-logid"></span></p>
            </div>
            
            <h3 class="subtitle mt-4">Lịch sử phân phối</h3>
            <div class="timeline box">
                <ul id="track-distribution-history"></ul>
            </div>
            
            <div class="has-text-centered mt-4">
                <div id="qrcode-container"></div>
            </div>
        </div>
    </div>
</div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- View Prescription Modal -->
    <div class="modal" id="view-prescription-modal">
        <div class="modal-background"></div>
        <div class="modal-card">
            <header class="modal-card-head">
                <p class="modal-card-title">Chi tiết đơn thuốc</p>
                <button class="delete" aria-label="close" id="close-prescription-modal"></button>
            </header>
            <section class="modal-card-body">
                <div class="content">
                    <p><strong>Mã đơn thuốc:</strong> <span id="modal-prescription-id"></span></p>
                    <p><strong>Bác sĩ:</strong> <span id="modal-prescription-doctor"></span></p>
                    <p><strong>Bệnh nhân:</strong> <span id="modal-prescription-patient"></span></p>
                    <p><strong>Ngày kê:</strong> <span id="modal-prescription-date"></span></p>
                    <p><strong>Trạng thái:</strong> <span id="modal-prescription-status"></span></p>
                    
                    <h4>Danh sách thuốc</h4>
                    <table class="table is-fullwidth">
                        <thead>
                            <tr>
                                <th>Tên thuốc</th>
                                <th>Liều dùng</th>
                                <th>Thời gian dùng</th>
                            </tr>
                        </thead>
                        <tbody id="modal-prescription-medicines">
                            <!-- Dynamic content -->
                        </tbody>
                    </table>
                </div>
            </section>
        </div>
    </div>
    
    <!-- View Order Modal -->
    <div class="modal" id="view-order-modal">
    <div class="modal-background"></div>
    <div class="modal-card">
        <header class="modal-card-head">
            <p class="modal-card-title">Chi tiết đơn hàng</p>
            <button class="delete" aria-label="close" id="close-order-modal"></button>
        </header>
        <section class="modal-card-body">
            <div class="content">
                <p><strong>Mã đơn hàng:</strong> <span id="modal-order-id"></span></p>
                <p><strong>Bệnh nhân:</strong> <span id="modal-order-patient"></span></p>
                <p><strong>Nhà thuốc:</strong> <span id="modal-order-pharmacy"></span></p>
                <p><strong>Ngày đặt:</strong> <span id="modal-order-date"></span></p>
                <p><strong>Trạng thái:</strong> <span id="modal-order-status"></span></p>
                <p><strong>Phê duyệt bác sĩ:</strong> <span id="modal-order-doctor-approval"></span></p>
                <p><strong>Phê duyệt bệnh nhân:</strong> <span id="modal-order-patient-approval"></span></p>
                
                <h4>Danh sách thuốc</h4>
                <table class="table is-fullwidth">
                    <thead>
                        <tr>
                            <th>Tên thuốc</th>
                            <th>Số lượng</th>
                            <th>Mã ghi nhận</th>
                        </tr>
                    </thead>
                    <tbody id="modal-order-items">
                        <!-- Dynamic content -->
                    </tbody>
                </table>
            </div>
        </section>
    </div>
</div>

<!-- Add View Request Modal -->
<div class="modal" id="view-request-modal">
    <div class="modal-background"></div>
    <div class="modal-card">
        <header class="modal-card-head">
            <p class="modal-card-title">Chi tiết yêu cầu</p>
            <button class="delete" aria-label="close" id="close-request-modal"></button>
        </header>
        <section class="modal-card-body">
            <div class="content">
                <p><strong>Mã yêu cầu:</strong> <span id="modal-request-id"></span></p>
                <p><strong>Nhà thuốc:</strong> <span id="modal-request-pharmacy"></span></p>
                <p><strong>Nhà phân phối:</strong> <span id="modal-request-distributor"></span></p>
                <p><strong>Ngày yêu cầu:</strong> <span id="modal-request-date"></span></p>
                <p><strong>Trạng thái:</strong> <span id="modal-request-status"></span></p>
                
                <h4>Danh sách thuốc</h4>
                <table class="table is-fullwidth">
                    <thead>
                        <tr>
                            <th>Tên thuốc</th>
                            <th>Số lượng</th>
                        </tr>
                    </thead>
                    <tbody id="modal-request-items">
                        <!-- Dynamic content -->
                    </tbody>
                </table>
            </div>
        </section>
    </div>
</div>
    
    <script src="dashboard.js"></script>
</body>
</html>
